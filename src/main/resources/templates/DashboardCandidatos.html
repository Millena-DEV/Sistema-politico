<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>União Brasil</title>
    <meta
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
      name="viewport"
    />
    <link rel="icon" th:href="@{/img/ub.jfif}" />
    <!-- Incluindo o Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Carregando jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Carregando jQuery Notify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-notify/1.0.2/jquery.notify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- Fonts and icons -->
      <script th:src="@{/js/plugin/webfont/webfont.min.js}"></script>

    <script>
      WebFont.load({
        google: { families: ["Public Sans:300,400,500,600,700"] },
        custom: {
          families: [
            "Font Awesome 5 Solid",
            "Font Awesome 5 Regular",
            "Font Awesome 5 Brands",
            "simple-line-icons",
          ],
          urls: ["/css/fonts.min.css"], // Corrigido aqui
        },
        active: function () {
          sessionStorage.fonts = true;
        },
      });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet">

    <!-- CSS Files -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/css/plugins.min.css}" />
    <link rel="stylesheet" th:href="@{/css/kaiadmin.min.css}" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" th:href="@{/css/demo.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  </head>
  <body>
    <div class="wrapper">
      <!-- Sidebar -->
      <div class="sidebar" data-background-color="white">
        <div class="sidebar-logo">
          <!-- Logo Header -->
          <div class="logo-header" data-background-color="white">
            <a th:href="@{/index}" class="logo">
              <img
                th:src="@{/img/logo.ico}"
                alt="navbar brand"
                class="navbar-brand"
               
              />
            </a>
            <div class="nav-toggle">
              <button class="btn btn-toggle toggle-sidebar">
                <i class="gg-menu-right"></i>
              </button>
              <button class="btn btn-toggle sidenav-toggler">
                <i class="gg-menu-left"></i>
              </button>
            </div>
            <button class="topbar-toggler more">
              <i class="gg-more-vertical-alt"></i>
            </button>
          </div>
          <!-- Fim do Cabeçalho do Logo -->
        </div>
  
        <div class="sidebar-wrapper scrollbar scrollbar-inner">
          <div class="sidebar-content">
            <ul class="nav nav-secondary">
              <li class="nav-item active">
                <a th:href="@{/index}"class="fas fa-home"><i class="fas fa-home"></i>inicio</a>
      
              </li>
              <li class="nav-section">
                <span class="sidebar-mini-icon">
                  <i class="fa fa-ellipsis-h"></i>
                </span>
                <h4 class="text-section">Menu</h4>
              </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="#tables">
                  <i class="bi bi-person-plus"></i>
                  <p>Cadastros</p>
                  <span class="caret"></span>
                </a>
                <div class="collapse" id="tables">
                  <ul class="nav nav-collapse">
                    <li>
                      <a th:href="@{/novo-filiado}">
                        <span class="sub-item"> Cadastrar Filiado Interno</span>
                      </a>
                    </li>
                    <li>
                      <a th:href="@{/cadastrar}">
                        <span class="sub-item">Novo Usuário</span>
                      </a>
                    </li>
                  
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a data-bs-toggle="collapse" href="#tables">
                  <i class="fas fa-table"></i>
                  <p>Consultas</p>
                  <span class="caret"></span>
                </a>
                <div class="collapse" id="tables">
                  <ul class="nav nav-collapse">

                   
                   
                    <li>
                      <a th:href="@{/filiados}">
                        <span class="sub-item">Filiados</span>
                      </a>
                    </li>
                    
                    <li>
                      <a th:href="@{/candidatos}">
                        <span class="sub-item">Cargos</span>
                      </a>
                    </li>
                  
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link d-flex align-items-center" aria-label="Ir para documentos">
                  <i class="fas fa-file mr-2"></i>
                  <span class="sub-item mr-2">Documentos</span>
                  <span class="badge badge-secondary" aria-hidden="true">1</span>
                </a>
              </li>
              
             
            </ul>
          </div>
        </div>
      </div>
      <!-- final menu vertical -->

      <div class="main-panel">
        <div class="main-header">
          <div class="main-header-logo">
            <!-- Logo Header -->
            <div class="logo-header" data-background-color="dark">
              <a th:href="@{../index.html}" class="logo">
                <img
                  th:src="@{/img/logo.ico}"
                  alt="navbar brand"
                  class="navbar-brand"
                
                />
              </a>
              <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar">
                  <i class="gg-menu-right"></i>
                </button>
                <button class="btn btn-toggle sidenav-toggler">
                  <i class="gg-menu-left"></i>
                </button>
              </div>
              <button class="topbar-toggler more">
                <i class="gg-more-vertical-alt"></i>
              </button>
            </div>
            <!-- End Logo Header -->
          </div>
          <!-- Navbar Header -->
          <nav
            class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom"
          >
            <div class="container-fluid">
              <nav
                class="navbar navbar-header-left navbar-expand-lg navbar-form nav-search p-0 d-none d-lg-flex"
              >
                <div class="input-group-prepend">
                  </div>
                  


                    <span class="profile-username">
                      <button class="btn btn-info" onclick="window.location.href='/candidatos';">Voltar</button>
                      <span class="op-7"  style="font-family: 'Roboto', sans-serif; font-size: 18px; font-weight: bold;"></span>
                      <span  style="font-family: 'Roboto', sans-serif; font-size: 18px; font-weight: bold;">Sua Função Definida é:
                     <span th:text="${userFuncao}"  style="font-family: 'Roboto', sans-serif; font-size: 18px; font-weight: bold; color:blue;"></span>!</span>
                     
                  </span>
             
              </nav>

              <ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
                <li
                  class="nav-item topbar-icon dropdown hidden-caret d-flex d-lg-none"
                >
                  <a
                    class="nav-link dropdown-toggle"
                    data-bs-toggle="dropdown"
                    href="#"
                    role="button"
                    aria-expanded="false"
                    aria-haspopup="true"
                  >
                    <i class="fa fa-search"></i>
                  </a>
                  
                </li>
                <li class="nav-item topbar-user dropdown hidden-caret">
                  <a
                    class="dropdown-toggle profile-pic"
                    data-bs-toggle="dropdown"
                    href="#"
                    aria-expanded="false"
                  >
                
                  </a>
                 
                </li>
              </ul>
            </div>
          </nav>
          <!-- End Navbar -->
        </div>
        <div class="container">
          <div class="page-inner">
            <form action="/dashboardCandidatos" method="get" id="filterForm">
                 
          </form>
           <div class="d-flex  pb-1">
              <div class="row">

                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Prefeitos
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalPrefeitos}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                              
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Vice-Prefeitos
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalVicePrefeitos}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                            
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Governadores
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalGovernador}" style="font-size: 40px; text-align: center; display: block;">0</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                          
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Vice-Governadores
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalViceGovernador}" style="font-size: 40px; text-align: center; display: block;">0</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                              
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                       <h5 >
                                        Senadores
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span  style="font-size: 40px; text-align: center; display: block;">7</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                              
                                <div class="col col-stats ms-3 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Deputados Federais
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalDeputadoFederal}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                      
                                    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto">
                    <div class="card card-stats card-round">
                        <div class="card-body">
                            <div class="row align-items-center">
                               <div class="col col-stats ms-1 ms-sm-0">
                                    <div class="numbers">
                                      <h5 >
                                        Vereadores
                                        <i class="fas fa-user-tie fa-1x"></i>
                                      </h5>
                                      <span th:text="${totalVereador}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="col-auto ">
                  <div class="card card-stats card-round">
                      <div class="card-body">
                          <div class="row align-items-center">
                              <div class="col col-stats ms-4 ms-sm-0">
                                  <div class="numbers">
                                    <h5 >
                                      Deputados Distritais
                                      <i class="fas fa-user-tie fa-1x"></i>
                                    </h5>
                                    <span th:text="${totalDeputadoDistrital}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              
                            <div class="col-auto  ">
                              <div class="card card-stats card-round">
                                  <div class="card-body">
                                      <div class="row align-items-center">
                                          <div class="col col-stats ms-4 ms-sm-0">
                                              <div class="numbers">
                                                <h5 >
                                                  Deputados  Estaduais
                                                  <i class="fas fa-user-tie fa-1x"></i>
                                                </h5>
                                                <span th:text="${totalDeputadoEstadual}" style="font-size: 40px; text-align: center; display: block;">0</span>
                                                </div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                                    
                <div style="display: flex; gap: 20px;">
                <div id="Grafico_candidato_genero"style="width: 450px; height:250px;text-align: center;"> Gráfico candidato por Gênero</div>
                <div id="Grafico_candidato_etinia"style="width: 450px; height:250px;text-align: center;">Gráfico de Candidatos Por Etinia</div>
                <div id="Grafico_cargos"style="width: 980px; height:250px;text-align: center;">Gráfico de cargos</div>
              </div>
         
          <br>
          <div>
            <label for="anoSelect">ANO: </label>
          <select id="anoSelect">
              <option value="">Todos</option>
              <option value="2024">2024</option>
              <option value="2022">2022</option>
              <option value="2020">2020</option>
          </select>
          <label for="partidoSelect">PARTIDO: </label>
          <select id="partidoSelect">
              <option value="">Todos</option>
              <option value="DEM">DEM</option>
              <option value="PSL">PSL</option>
              <option value="UNIÃO">UNIÃO</option>
          </select>

          <label for="cargoSelect"> Cargo: </label>
          <select id="cargoSelect">
              <option value="">Todos</option>
              <option value="SENADOR">Senador</option>
              <option value="DEPUTADO">Deputado Federal</option>
              <option value="GOVERNADOR">Governador</option>
              <option value="PREFEITO">Prefeito</option>
              <option value="VICE-PREFEITO">Vice-Prefeito</option>
              <option value="VEREADOR">Vereador</option>
              <option value="DEPUTADO DISTRITAL">Deputado Distrital</option>
              <option value="DEPUTADO ESTADUAL">Deputado Estadual</option>
          </select>
          <label for="ufSelect"> UF: </label>
          <select id="ufSelect">
              
          </select>
            <button id="btnPesquisar">Pesquisar</button>

        </div>
          <div id="Grafico_candidato"style="height:350px;text-align: center;">Gráfico de Candidatos por UF</div>
        </div>
      </div>
    </div>
  </div>
        <footer class="footer">
          <div class="container-fluid d-flex justify-content-between">
            <nav class="pull-left">
              <ul class="nav">
                <li class="nav-item">
                  <a class="nav-link" th:href="@{https://uniaobrasil.org.br/filie-se/}">
                    Filiar 
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="https://wa.me/61994180629?text=Olá%2C%20gostaria%20de%20mais%20informações">  Ajuda </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"> União Brasil </a>
                </li>
              </ul>
            </nav>
            <div class="copyright">
              2024, União Brasil <i class="fa fa-heart heart text-danger"></i> by
              <a th:href="@{https://uniaobrasil.org.br/}">Site</a>
            </div>

          </div>
        </footer>
      </div>
    

  
      <!-- Custom template | don't include it in your project! -->
      <div class="custom-template">
        <div class="title">Configurar</div>
        <div class="custom-content">
          <div class="switcher">
            <div class="switch-block">
              <h4>Logo Header</h4>
              <div class="btnSwitch">
                <button
                  type="button"
                  class="selected changeLogoHeaderColor"
                  data-color="dark"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="blue"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="purple"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="light-blue"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="green"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="orange"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="red"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="white"
                ></button>
                <br />
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="dark2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="blue2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="purple2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="light-blue2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="green2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="orange2"
                ></button>
                <button
                  type="button"
                  class="changeLogoHeaderColor"
                  data-color="red2"
                ></button>
              </div>
            </div>
            <div class="switch-block">
              <h4>Menu vertical</h4>
              <div class="btnSwitch">
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="dark"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="blue"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="purple"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="light-blue"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="green"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="orange"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="red"
                ></button>
                <button
                  type="button"
                  class="selected changeTopBarColor"
                  data-color="white"
                ></button>
                <br />
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="dark2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="blue2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="purple2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="light-blue2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="green2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="orange2"
                ></button>
                <button
                  type="button"
                  class="changeTopBarColor"
                  data-color="red2"
                ></button>
              </div>
            </div>
            <div class="switch-block">
              <h4>Menu Horizontal</h4>
              <div class="btnSwitch">
                <button
                  type="button"
                  class="changeSideBarColor"
                  data-color="white"
                ></button>
                <button
                  type="button"
                  class="selected changeSideBarColor"
                  data-color="dark"
                ></button>
                <button
                  type="button"
                  class="changeSideBarColor"
                  data-color="dark2"
                ></button>
              </div>
            </div>
          </div>
        </div>
        <div class="custom-toggle">
          <i class="icon-settings"></i>
        </div>
      </div>
      <!-- End Custom template -->

  <!-- Core JS Files -->
<script th:src="@{/js/core/jquery-3.7.1.min.js}"></script>
<script th:src="@{/js/core/popper.min.js}"></script>
<script th:src="@{/js/core/bootstrap.min.js}"></script>

<!-- jQuery Scrollbar -->
<script th:src="@{/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js}"></script>

<!-- Chart JS -->
<script th:src="@{/js/plugin/chart.js/chart.min.js}"></script>

<!-- jQuery Sparkline -->
<script th:src="@{/js/plugin/jquery.sparkline/jquery.sparkline.min.js}"></script>

<!-- Chart Circle -->
<script th:src="@{/js/plugin/chart-circle/circles.min.js}"></script>

<!-- Datatables -->
<script th:src="@{/js/plugin/datatables/datatables.min.js}"></script>

<!-- Bootstrap Notify -->
<!--<script th:src="@{/js/plugin/bootstrap-notify/bootstrap-notify.min.js}"></script>-->

<!-- jQuery Vector Maps -->
<script th:src="@{/js/plugin/jsvectormap/jsvectormap.min.js}"></script>
<script th:src="@{/js/plugin/jsvectormap/world.js}"></script>

<!-- Sweet Alert -->
<script th:src="@{/js/plugin/sweetalert/sweetalert.min.js}"></script>

<!-- Kaiadmin JS -->
<script th:src="@{/js/kaiadmin.min.js}"></script>

<!-- Kaiadmin DEMO methods, don't include it in your project! -->
<script th:src="@{/js/setting-demo.js}"></script>
<script th:src="@{/js/demo.js}"></script>

<script>
  

  async function preencherUFSelect() {
        // Lista das UFs (substitua com a lista real de UFs se necessário)
  const ufs = [
      'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA', 'MT', 'MS', 'MG', 
      'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN', 'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
  ];

  // Ordena as UFs em ordem alfabética
  ufs.sort();
    // Faz a requisição para obter o usuário logado
    const response = await fetch("/api/usuario/logado");
    const dataUsuario = await response.json();
    const ufUsuario = dataUsuario.uf;  // UF do usuário logado
    const roleUsuario = dataUsuario.funcao;  // Função do usuário (role)

    // Ordena as UFs
    ufs.sort();

    // Limpa o conteúdo do select antes de preenchê-lo
    ufSelect.innerHTML = '';

   

    // Se o usuário for operador estadual, a UF será a do usuário logado
    if (["CONSULTOR_ESTADUAL", "OPERADOR_ESTADUAL", "ADM_ESTADUAL","OPERADOR_MUNICIPAL","CONSULTOR_MUNICIPAL"].includes(roleUsuario) && ufUsuario) {
        const option = document.createElement('option');
        option.value = ufUsuario;
        option.textContent = ufUsuario;
        option.selected = true;  // Define a UF do usuário como selecionada
        ufSelect.appendChild(option);
        $('#btnPesquisar').click();
    }else{
        // Adiciona a opção "Todos"
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Todos';
        ufSelect.appendChild(defaultOption);
         // Adiciona as outras UFs ao select, exceto a UF já selecionada
        ufs.forEach(uf => {
          if (uf !== ufUsuario) {
              const option = document.createElement('option');
              option.value = uf;
              option.textContent = uf;
              ufSelect.appendChild(option);
          }
      });
    }

   
}
$('#btnPesquisar').click();
// Chama a função para preencher o select ao carregar a página
preencherUFSelect();
  // Adiciona as UFs ordenadas ao select
  /*ufs.forEach(function(uf) {
      const option = document.createElement('option');
      option.value = uf;
      option.textContent = uf;
      ufSelect.appendChild(option);
  });*/
   $(document).ready(function() {
      
        let ano = $('#anoSelect').val();  // Agora 'let' permite reatribuição do valor
        
        if (ano === '') {  // Se o ano for vazio, defina o ano como 2024
            ano = '2024';
        }
        let partido = $('#partidoSelect').val(); // Partido fixo
        if (partido === '') {  // Se o ano for vazio, defina o ano como 2024
          partido = 'UNIÃO';
      }
        const cargo = $('#cargoSelect').val();  // Pegando o valor do cargo selecionado
        const uf = $('#ufSelect').val();  // Pegando o valor da UF selecionada (se houver)
   
        // Chama a função para buscar os dados com os filtros aplicados
        fetchData(ano, partido, cargo, uf);  // Passa os parâmetros para a função
        $('#btnPesquisar').on('click', function() {
          // Pegando os valores dos filtros
          let ano = $('#anoSelect').val();
          if (ano === '') {
              ano = '2024';  // Se o ano não for selecionado, definir como 2024
          }
  
          let partido = $('#partidoSelect').val(); 
          if (partido === '') {  
            partido = 'UNIÃO';
        }  
          const cargo = $('#cargoSelect').val();  // Cargo selecionado
          const uf = $('#ufSelect').val();  // UF selecionada
  
          console.log("Filtros aplicados:", { ano, partido, cargo, uf });
  
          // Chama a função para buscar os dados com os filtros aplicados
          fetchData(ano, partido, cargo, uf);
      });
    });

    function submitForm() {
        let ano = $('#anoSelect').val();  // Agora 'let' permite reatribuição do valor
        if (ano === '') {  // Se o ano for vazio, defina o ano como 2024
            ano = '2024';
        }
        
        let partido = $('#partidoSelect').val(); // Partido fixo
        if (partido === '') {  // Se o ano for vazio, defina o ano como 2024
          partido = 'UNIÃO';
      }
        const cargo = $('#cargoSelect').val();  // Pegando o valor do cargo selecionado
        const uf = $('#ufSelect').val();  // Pegando o valor da UF selecionada (se houver)

        console.log("Filtros aplicados:", { ano, partido, cargo, uf });

        fetchData(ano, partido, cargo, uf);  // Chama a função para buscar os dados com os filtros aplicados
    }
          
    async function fetchData(ano, partido, cargo, uf) {
      try {
          // Construir a URL com os parâmetros válidos
          let url = `/api/candidatos?ano=${ano}&partido=${partido}`;
          
            // Só adiciona 'cargo' se ele não for vazio
            if (cargo !== '') { 
              url += `&cargo=${cargo}`;
          }
          
          // Só adiciona 'uf' se ele não for vazio
          if (uf !== '') { 
              url += `&uf=${uf}`;
          }
         
      
          console.log("Requisição API com os filtros:", url);
          const response = await fetch(url);
          const data = await response.json(); // Espera a resposta com os dados de candidatos
          console.log("Dados recebidos da API:", response);
          console.log("Dados recebidos da API:", data);
          
          // Organize the data for the chart
          renderChart( data,ano, partido, cargo, uf)
          updateGeneroChart(data,uf,partido); 
          updateEtiniaChart(data,uf,partido); // Renderiza o gráfico de gênero
          updatecargos(data, uf,partido);
          concole.log(data)
      } catch (error) {
          //console.error('Erro ao buscar dados:', error);
      }
  }
  
  function renderChart( data,ano, partido, cargo, uf) {
    const chartElement = document.querySelector("#Grafico_candidato");

    // Verificação de existência do elemento de gráfico
    if (!chartElement) {
        console.error("Elemento de gráfico não encontrado.");
        return;
    }

    // Verificação de dados recebidos
    if (!Array.isArray(data) || data.length === 0) {
        console.error("Nenhum dado disponível para o gráfico.");
        return;
    }

    // Organize the data by UF and cargo
    const ufData = {};

    data.forEach(item => {
        // Verifica se o item contém os dados necessários
        if (!item.cargo || !['ELEITO POR QP', 'ELEITO POR MEDIA', 'ELEITO','ELEITO POR MÉDIA'].includes(item.situ_cand)) {
            return;
        }

        // Verifica se o mandato é válido para o ano filtrado
        if (item.ano_validade_mandato > ano && item.partido === partido) {
            // Inicializa a UF no objeto se não existir
            if (!ufData[item.uf]) {
                ufData[item.uf] = {};
            }

            // Inicializa o cargo para a UF se não existir
            if (!ufData[item.uf][item.cargo]) {
                ufData[item.uf][item.cargo] = 0;
            }

            // Incrementa o número de eleitos para o cargo naquela UF
            ufData[item.uf][item.cargo]++;
           
        }
    });

      // Calcular o total de cargos eleitos por cada UF
    let ufs = Object.keys(ufData).map(uf => {
      // Soma o total de eleitos para todos os cargos dentro de cada UF
      const totalEleitos = Object.values(ufData[uf]).reduce((acc, count) => acc + count, 0);
      return { uf, totalEleitos };  // Retorna a UF e a soma dos eleitos
    });

    // Ordenar as UFs do maior para o menor número de eleitos
    ufs = ufs.sort((a, b) => b.totalEleitos - a.totalEleitos);

    // Extrair apenas as UFs ordenadas
    ufs = ufs.map(item => item.uf);


    // Se houver filtro de UF, mostra apenas a UF filtrada
    if (uf && ufs.indexOf(uf) === -1) {
        return; // Não mostra nada se a UF filtrada não existir nos dados
    }

    if (uf) {
        ufs = [uf]; // Se há filtro de UF, mostra somente a UF filtrada
    }

    //const cargos = [...new Set(data.map(item => item.cargo))]; // Lista única de cargos
    
      // Caso não haja filtro de cargo, mostramos todos os cargos
      let cargos = [];
      if (cargo) {
          cargos = [cargo]; // Quando o filtro de cargo for aplicado, mostre apenas o cargo filtrado
         
      } else {
          // Se não houver filtro de cargo, vamos pegar todos os cargos disponíveis nas UFs filtradas
          cargos = [...new Set(data.filter(item => ufs.includes(item.uf)).map(item => item.cargo))];
        
      }
    // Filtra os cargos que têm 1 ou mais eleitos
    const cargosValidos = cargos.filter(cargo => {
        return ufs.some(uf => ufData[uf][cargo] > 0); // Verifica se o cargo tem pelo menos 1 eleito em alguma UF
    });


    const seriesData = [];

    cargosValidos.forEach(cargo => {
        const dataForCargo = ufs.map(uf => ufData[uf][cargo] || 0); // Contagem de eleitos por UF
        seriesData.push({
            name: cargo,
            data: dataForCargo
           
        });
    });
    

    // Verificar se temos cargos para exibir
    if (seriesData.length === 0) {
        console.error("Nenhum cargo encontrado nos dados.");
        return;
    }

    // Definir cores para cada cargo de forma dinâmica
    const cargoColors = ['#FF5733', '#33FF57', '#3357FF', '#F1C40F', '#006400', '#4B0082', '#FF00FF', '#8A2BE2'];

    const options = {
        series: seriesData,
        chart: {
            height: 350,
            type: 'bar',
            stacked: true,
            events: {
                dataPointMouseEnter: function(event, chartContext, config) {
                    // Ação ao passar o mouse sobre o gráfico de barras
                    const uf = ufs[config.dataPointIndex];
                    updateGeneroChart(data, uf,partido);
                    updateEtiniaChart(data, uf,partido);  // Atualiza o gráfico de gênero e etnia com base na UF
                    updatecargos(data, uf,partido)
                }
            }
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '80%',
                distributed: true, // Distribui as cores igualmente entre os cargos
            }
        },
        xaxis: {
            categories: ufs, // UFs no eixo X
            labels: {
                style: {
                    fontSize: '12px',
                }
            }
        },
        yaxis: {
            show: true, // Exibe o eixo Y
           
        },
        colors: cargoColors.slice(0, seriesData.length), // Cor única para todas as barras de UFs
        fill: {
            colors: ['#00A4E8'], 
        },
        dataLabels: {
            enabled: true, // Habilita os valores nas barras
        },
        legend: {
          show: true,
          position: 'top',
          horizontalAlign: 'center',
          floating: true,
          fontSize: '12px',
          // Aqui a legenda só vai mostrar o cargo filtrado
          formatter: function(seriesName) {
                return cargo || seriesName; // Se o cargo estiver filtrado, ele será exibido
            },
      },
    };


        // Remove o gráfico antigo, se houver
    const oldChart = document.querySelector('#Grafico_candidato .apexcharts-canvas');
    if (oldChart) oldChart.remove();

  
      // Tenta renderizar o gráfico
      const chart = new ApexCharts(chartElement, options);
      try {
          chart.render();
      } catch (error) {
          //console.error("Erro ao renderizar o gráfico:", error);
      }
  }
    
 // Chama a função após o DOM ser carregado
      
      // Chama a função para buscar os dados
     // fetchData();
/*****************************************************************************************/
  // Função que atualiza o gráfico de gênero ao passar o mouse sobre o gráfico de candidatos
  let generoChart = null; // Variável global para armazenar o gráfico de gênero

  function updateGeneroChart(data, uf,partido) {
      // Filtra os dados pela UF
      const ufData = uf ? data.filter(item => item.uf === uf && item.partido === partido): data.filter(item => item.partido === partido);
  
      // Conta o número de candidatos masculinos e femininos
      const maleCount = ufData.filter(item => item.genero === 'MASCULINO').length;
      const femaleCount = ufData.filter(item => item.genero === 'FEMININO').length;
  
      //console.log('UF:', uf);
      //console.log('Filtered Data for Gender:', ufData); // Verifica os dados filtrados para depuração
  
       // Definindo o título para a UF
    const title = `Gênero dos candidatos da UF: ${uf}`;

    const options = {
        series: [maleCount, femaleCount],
        chart: {
            type: 'pie',
        },
        labels: ['Masculino', 'Feminino'],
        colors: ['rgb(142, 182, 250) 100%)', '#FF69B4'],
        title: {
            text: title, // Exibe a UF no título do gráfico
            align: 'center',
            style: {
                fontSize: '12px',
                fontWeight: 'bold',
                color: '#333'
            }
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };
      const chartElement = document.querySelector("#Grafico_candidato_genero");
  
      if (!chartElement) {
          //console.error("Elemento de gráfico de gênero não encontrado.");
          return;
      }
  
      // Se o gráfico de gênero já foi criado, destrua-o antes de criar um novo
      if (generoChart !== null) {
          generoChart.destroy();
      }
  
      // Cria o gráfico de gênero
      generoChart = new ApexCharts(chartElement, options);
  
      try {
          generoChart.render();
          //console.log(`Gráfico de gênero para a UF ${uf} renderizado com sucesso!`);
      } catch (error) {
         // console.error("Erro ao renderizar o gráfico de gênero:", error);
      }
  }
  
    
    /*************************************************************************************************/
    let etiniaChart = null; // Variável global para armazenar o gráfico de etnia

function updateEtiniaChart(data, uf,partido) {
    // Filtra os dados pela UF
    const ufData = uf ? data.filter(item => item.uf === uf && item.partido === partido): data.filter(item => item.partido === partido);

    // Conta o número de candidatos negros e não negros
    const negro = ufData.filter(item => item.etinia === 'NEGRO').length;
    const branco = ufData.filter(item => item.etinia === 'NÃO NEGRO').length;
   

    const title = `Etnia dos candidatos da UF: ${uf}`;

    const options = {
        series: [negro, branco],
        chart: {
            type: 'pie',
        },
        labels: ['NEGRO', 'NÃO NEGRO'],
        colors: ['rgb(0, 1, 2) 10%)', '#8C62A4'],
        title: {
            text: title, // Exibe a UF no título do gráfico
            align: 'center',
            style: {
                fontSize: '12px',
                fontWeight: 'bold',
                color: '#333'
            }
        },
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };
   // console.log(ufData);  // Exibe os dados filtrados para depuração

    const chartElement = document.querySelector("#Grafico_candidato_etinia");

    if (!chartElement) {
       // console.error("Elemento de gráfico de etnia não encontrado.");
        return;
    }

    // Se o gráfico de etnia já foi criado, destrua-o antes de criar um novo
    if (etiniaChart !== null) {
        etiniaChart.destroy();
    }

    // Cria o gráfico de etnia
    etiniaChart = new ApexCharts(chartElement, options);

    try {
        etiniaChart.render();
        //console.log(`Gráfico de etnia para a UF ${uf} renderizado com sucesso!`);
    } catch (error) {
        //console.error("Erro ao renderizar o gráfico de etnia:", error);
    }
}
 /********************************************************************************************************************************/
 let cargosChart = null;
 function updatecargos(data, uf,partido) {
  // Filtra os dados pela UF
  const cargoData = uf ? data.filter(item => item.uf === uf && item.partido === partido) : data.filter(item => item.partido === partido);
  // Conta o número de candidatos negros e não negros
  const prefeito = cargoData.filter(item => item.cargo === 'PREFEITO').length;
  const vice_prefeito= cargoData.filter(item => item.cargo === 'VICE PREFEITO').length;
  const governador= cargoData.filter(item => item.cargo === 'GOVERNADOR').length;
  const vice_governador= cargoData.filter(item => item.cargo === 'VICE GOVERNADOR').length;
  const senadores= cargoData.filter(item => item.cargo === 'SENADOR').length;
  const dep_federal= cargoData.filter(item => item.cargo === 'DEPUTADO FEDERAL').length;
  const dep_distrital= cargoData.filter(item => item.cargo === 'DEPUTADO DISTRITAL').length;
  const dep_estadual= cargoData.filter(item => item.cargo === 'DEPUTADO ESTADUAL').length;
  const vereador= cargoData.filter(item => item.cargo === 'VEREADOR').length;

  const title = `Cargos da UF: ${uf}`;
        var options = {
          series: [{
          data: [prefeito,vice_prefeito,governador,vice_governador,senadores,dep_federal,dep_distrital,dep_estadual,vereador]
        }],
        title: {
          text: title, // Exibe a UF no título do gráfico
          align: 'center',
          style: {
              fontSize: '13px',
              fontWeight: 'bold',
              color: '#333'
          }
      },
          chart: {
          type: 'bar',
          height: 450
        },
        plotOptions: {
          bar: {
            borderRadius: 5,
            borderRadiusApplication: 'end',
            horizontal: true,
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
         
          categories: ['PREFEITO', 'VICE PREFEITO', 'GOVERNADOR', 'VICE GOVERNADOR', 'SENADOR', 'DEPUTADO FEDERAL', 'DEPUTADO DISTRITAL',
            'DEPUTADO ESTADUAL', 'VEREADOR'
          ],
        }
        };

        const chartElement = document.querySelector("#Grafico_cargos");

            if (!chartElement) {
              // console.error("Elemento de gráfico de etnia não encontrado.");
                return;
            }

            // Se o gráfico de etnia já foi criado, destrua-o antes de criar um novo
            if (cargosChart !== null) {
                cargosChart.destroy();
            }

            // Cria o gráfico de etnia
            cargosChart = new ApexCharts(chartElement, options);

            try {
                cargosChart.render();
                //console.log(`Gráfico de etnia para a UF ${uf} renderizado com sucesso!`);
            } catch (error) {
                //console.error("Erro ao renderizar o gráfico de etnia:", error);
            }
      
 }
    </script>
  </body>
</html>
